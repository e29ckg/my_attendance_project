<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Sarabun', sans-serif; }
        .card { border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .bg-gradient-primary { background: linear-gradient(45deg, #4e73df, #224abe); color: white; }
        @media print {
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤, ‡πÄ‡∏°‡∏ô‡∏π ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå */
            .btn, .form-label, .form-control, .form-select, .card-header, .btn-outline-secondary {
                display: none !important;
            }
            /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
            .container {
                width: 100% !important;
                max-width: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .card {
                border: none !important;
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="container py-5">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-primary fw-bold">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h2>
            <a href="/manage_users" class="btn btn-outline-secondary">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</a>
        </div>

        <div class="row g-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-gradient-primary">
                        <h5 class="mb-0">üìÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-end mb-3">
                            <div class="col-md-4">
                                <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                                <input type="date" class="form-control" v-model="selectDate">
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</label>
                                <select class="form-select" v-model="selectRole">
                                    <option value="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                    {% raw %}
                                    <option v-for="role in roles" :key="role" :value="role">
                                        {{ role ? role : '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)' }}
                                    </option>
                                    {% endraw %}
                                </select>                                
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary w-100" @click="loadDailyReport">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-bordered text-center align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>‡∏£‡∏´‡∏±‡∏™</th>
                                        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th> <th>‡πÄ‡∏Ç‡πâ‡∏≤ (04:00-12:00)</th>
                                        <th>‡∏≠‡∏≠‡∏Å (12:00-00:00)</th>
                                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% raw %}
                                    <tr v-for="row in dailyData" :key="row.employee_id">
                                        <td>{{ row.employee_id }}</td>
                                        <td class="text-start">{{ row.name }}</td>
                                        <td class="text-secondary">{{ row.role }}</td>
                                        <td class="fw-bold text-success">{{ row.in_time }}</td>
                                        <td class="fw-bold text-danger">{{ row.out_time }}</td>
                                        <td>
                                            <span v-if="row.status == '‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'" class="badge bg-success">‡∏°‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                                            <span v-else class="badge bg-secondary">‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô</span>
                                        </td>
                                    </tr>
                                    <tr v-if="dailyData.length === 0">
                                        <td colspan="6" class="text-muted py-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td>
                                    </tr>
                                    {% endraw %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</button>
                </div>
            </div>

            <div class="col-md-12">
                <div class="card border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üìë ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Excel)</h5>
                    </div>
                    <div class="card-body d-flex align-items-end gap-3">
                        <div class="flex-grow-1">
                            <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
                            <input type="month" class="form-control" v-model="selectMonth">
                        </div>
                        <button class="btn btn-success px-4" @click="downloadMonthly">
                            üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const today = new Date().toISOString().split('T')[0];
                const currentMonth = today.slice(0, 7);

                const selectDate = ref(today);
                const selectMonth = ref(currentMonth);
                const selectRole = ref("‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"); // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                const roles = ref([]); // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const dailyData = ref([]);

                // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏°‡∏≤‡πÉ‡∏™‡πà Dropdown
                const loadRoles = async () => {
                    try {
                        const res = await axios.get('/api/roles');
                        roles.value = res.data;
                    } catch (error) {
                        console.error("‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    }
                };

                // 2. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)
                const loadDailyReport = async () => {
                    try {
                        const res = await axios.get(`/api/report/daily?date=${selectDate.value}&role=${selectRole.value}`);
                        dailyData.value = res.data;
                    } catch (error) {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                    }
                };

                const downloadMonthly = () => {
                    if(!selectMonth.value) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô");
                    window.location.href = `/api/report/export_monthly?month=${selectMonth.value}`;
                };

                onMounted(() => {
                    loadRoles();       // ‡πÇ‡∏´‡∏•‡∏î Dropdown ‡∏Å‡πà‡∏≠‡∏ô
                    loadDailyReport(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
                });

                return {
                    selectDate, selectMonth, selectRole, roles, dailyData,
                    loadDailyReport, downloadMonthly
                };
            }
        }).mount('#app');
    </script>
</body>
</html>