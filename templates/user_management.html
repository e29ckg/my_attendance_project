<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - AI Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; }
        
        /* Profile Image Style */
        .avatar-img {
            width: 55px;
            height: 55px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .avatar-img:hover { transform: scale(1.1); }
        
        /* Card Style */
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
        .table-hover tbody tr:hover { background-color: #f8f9fa; }
        
        /* Badge Colors */
        .badge-role { font-size: 0.85em; padding: 6px 10px; border-radius: 20px; font-weight: 500; }
        .role-guard { background-color: #e3f2fd; color: #0d47a1; }     /* ‡∏£‡∏õ‡∏† ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ */
        .role-maid { background-color: #fce4ec; color: #880e4f; }      /* ‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π */
        .role-intern { background-color: #fff3e0; color: #e65100; }    /* ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™‡∏µ‡∏™‡πâ‡∏° */
        .role-staff { background-color: #e8f5e9; color: #1b5e20; }     /* ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */

        /* Nav Tabs */
        .nav-pills .nav-link.active { background-color: #4361ee; }
        .nav-link { color: #555; font-weight: 600; }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold text-primary"><i class="fas fa-users-cog"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
                <p class="text-muted">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
            </div>
            <a href="/dashboard" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</a>
        </div>

        <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-emp">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (Employees)</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-rules">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞ (Rules)</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-shifts">üìÖ ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏ß‡∏£ (Schedule)</button></li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="tab-emp">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="card p-4">
                            <h5 class="mb-3"><i class="fas fa-user-plus"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h5>
                            <form id="regForm">
                                <div class="mb-3">
                                    <label class="form-label small text-muted">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (ID)</label>
                                    <input type="text" id="reg_id" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1001" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small text-muted">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="reg_name" class="form-control" placeholder="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</label>
                                    <select class="form-select" id="edit_role" v-model="editForm.role">
                                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                        <option value="‡∏£‡∏õ‡∏†">‡∏£‡∏õ‡∏†.</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î1">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î1</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î2">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î2</option>
                                        <option value="‡∏Ñ‡∏ô‡∏™‡∏ß‡∏ô">‡∏Ñ‡∏ô‡∏™‡∏ß‡∏ô</option>
                                        <option value="‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small text-muted">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á</label>
                                    <input type="file" id="reg_file" class="form-control" required accept="image/*">
                                </div>
                                <button type="button" onclick="registerUser()" class="btn btn-primary w-100 fw-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <div class="card p-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="m-0">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
                                <span class="badge bg-light text-dark border" id="userCount">0 ‡∏Ñ‡∏ô</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 80px;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                            <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                            <th class="text-end">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                        </tr>
                                    </thead>
                                    <tbody id="empTableBody">
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-rules">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card p-4">
                            <h5>üïí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h5>
                            <form id="ruleForm">
                                <input type="text" id="rule_name" class="form-control mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏∞ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤)" required>
                                <div class="row g-2">
                                    <div class="col-6"><label class="small">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</label><input type="time" id="s_time" class="form-control"></div>
                                    <div class="col-6"><label class="small">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏¢</label><input type="time" id="l_time" class="form-control"></div>
                                </div>
                                <div class="mt-2 mb-3">
                                    <label class="small">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</label><input type="time" id="e_time" class="form-control">
                                </div>
                                <button type="button" onclick="saveRule()" class="btn btn-info text-white w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏∞</button>
                            </form>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card p-4">
                            <table class="table table-bordered">
                                <thead class="table-light"><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏∞</th><th>‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</th><th>‡∏™‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</th><th>‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</th><th>‡∏•‡∏ö</th></tr></thead>
                                <tbody id="ruleTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tab-shifts">
                <div class="card p-4">
                    <div class="row align-items-end">
                        <div class="col-md-3">
                            <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                            <input type="text" id="sch_id" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏ ID">
                        </div>
                        <div class="col-md-3">
                            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏∞‡∏á‡∏≤‡∏ô</label>
                            <select id="sch_rule" class="form-select"></select>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                                <input type="date" id="sch_start" class="form-control">
                                <span class="input-group-text">‡∏ñ‡∏∂‡∏á</span>
                                <input type="date" id="sch_end" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <button onclick="saveSchedule()" class="btn btn-success w-100">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        </div>
                    </div>
                    <hr>
                    <h6 class="text-muted">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h6>
                    <table class="table table-sm">
                        <thead><tr><th>ID</th><th>‡∏Å‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th><th>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏•‡∏ö</th></tr></thead>
                        <tbody id="schedTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="edit_preview" src="" class="avatar-img mb-3" style="width: 120px; height: 120px; object-fit: cover;">
                    
                    <input type="hidden" id="edit_id">
                    
                    <div class="mb-3 text-start">
                        <label class="form-label small text-muted">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                        <input type="file" id="edit_file" class="form-control form-control-sm" accept="image/*" onchange="previewEditImage(this)">
                    </div>

                    <input type="text" id="edit_name" class="form-control mb-3" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                    <div class="mb-3">
                                    <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</label>
                                    <select class="form-select" id="edit_role" v-model="editForm.role">
                                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                        <option value="‡∏£‡∏õ‡∏†">‡∏£‡∏õ‡∏†.</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î1">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î1</option>
                                        <option value="‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î2">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ä‡∏∏‡∏î2</option>
                                        <option value="‡∏Ñ‡∏ô‡∏™‡∏ß‡∏ô">‡∏Ñ‡∏ô‡∏™‡∏ß‡∏ô</option>
                                        <option value="‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                    </select>
                                </div>
                    <button onclick="confirmUpdate()" class="btn btn-primary w-100">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ---
        async function loadEmployees() {
            const res = await fetch('/api/employees');
            const data = await res.json();
            document.getElementById('userCount').innerText = `${data.length} ‡∏Ñ‡∏ô`;
            
            const tbody = document.getElementById('empTableBody');
            tbody.innerHTML = '';
            
            data.forEach(user => {
                // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ Badge ‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
                let roleClass = 'role-staff';
                if(user.role === '‡∏£‡∏õ‡∏†') roleClass = 'role-guard';
                else if(user.role === '‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô') roleClass = 'role-maid';
                else if(user.role === '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤') roleClass = 'role-intern';

                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Path ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Dummy)
                // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: user.image_path ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 'images/1001.jpg' ‡∏´‡∏£‡∏∑‡∏≠ 'C:/project/images/...' 
                // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ Web Server mount static files ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà /images ‡πÅ‡∏•‡πâ‡∏ß
                let imgSrc = `/${user.image_path}`.replace('//', '/'); 
                
                tbody.innerHTML += `
                    <tr>
                        <td>
                            <img src="${imgSrc}" class="avatar-img" 
                                 onerror="this.src='https://ui-avatars.com/api/?name=${user.name}&background=random'">
                        </td>
                        <td class="fw-bold text-secondary">${user.employee_id}</td>
                        <td>${user.name}</td>
                        <td><span class="badge badge-role ${roleClass}">${user.role}</span></td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-warning me-1" 
                                onclick="openEdit('${user.employee_id}', '${user.name}', '${user.role}', '${imgSrc}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${user.employee_id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
        }

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Add / Edit / Delete) ---
        async function registerUser() {
            const fd = new FormData();
            fd.append('emp_id', document.getElementById('reg_id').value);
            fd.append('name', document.getElementById('reg_name').value);
            fd.append('role', document.getElementById('reg_role').value);
            fd.append('file', document.getElementById('reg_file').files[0]);

            if(!document.getElementById('reg_file').files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");

            const res = await fetch('/api/register', { method: 'POST', body: fd });
            if(res.ok) {
                alert("‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                document.getElementById('regForm').reset();
                loadEmployees();
            }
        }

// [‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå user_management.html ‡∏™‡πà‡∏ß‡∏ô <script>]

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å
function openEdit(id, name, role, img) {
    document.getElementById('edit_id').value = id;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_role').value = role;
    document.getElementById('edit_preview').src = img;
    
    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡∏°‡πà
    document.getElementById('edit_file').value = ""; 
    
    new bootstrap.Modal(document.getElementById('editModal')).show();
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
function previewEditImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('edit_preview').src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
async function confirmUpdate() {
    const fd = new FormData();
    fd.append('emp_id', document.getElementById('edit_id').value);
    fd.append('name', document.getElementById('edit_name').value);
    fd.append('role', document.getElementById('edit_role').value);
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const fileInput = document.getElementById('edit_file');
    if (fileInput.files[0]) {
        fd.append('file', fileInput.files[0]);
    }
    
    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Backend
    await fetch('/api/employees/update', { method: 'POST', body: fd });
    
    bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
    loadEmployees(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
}

        async function deleteUser(id) {
            if(confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™ ${id} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                await fetch(`/api/employees/delete/${id}`, { method: 'DELETE' });
                loadEmployees();
            }
        }

        // --- 3. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Rules & Schedules) ---
        async function loadRules() {
            const res = await fetch('/api/work_rules');
            const data = await res.json();
            
            // ‡πÉ‡∏™‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            document.getElementById('ruleTable').innerHTML = data.map(r => `
                <tr>
                    <td>${r.role_name}</td>
                    <td>${r.start_time}</td>
                    <td class="text-danger">${r.late_threshold}</td>
                    <td>${r.end_time}</td>
                    <td><button onclick="delRule('${r.role_name}')" class="btn btn-sm btn-light text-danger">x</button></td>
                </tr>`).join('');
            
            // ‡πÉ‡∏™‡πà Dropdown
            document.getElementById('sch_rule').innerHTML = data.map(r => 
                `<option value="${r.role_name}">${r.role_name} (${r.start_time}-${r.end_time})</option>`
            ).join('');
        }

        async function saveRule() {
            const fd = new FormData();
            fd.append('role_name', document.getElementById('rule_name').value);
            fd.append('start_time', document.getElementById('s_time').value);
            fd.append('late_threshold', document.getElementById('l_time').value);
            fd.append('end_time', document.getElementById('e_time').value);
            await fetch('/api/work_rules/save', { method: 'POST', body: fd });
            loadRules();
        }

        async function delRule(name) {
            if(confirm('‡∏•‡∏ö‡∏Å‡∏∞‡∏ô‡∏µ‡πâ?')) { await fetch(`/api/work_rules/delete/${name}`, {method:'DELETE'}); loadRules(); }
        }

        async function loadSchedules() {
            const res = await fetch('/api/schedules');
            const data = await res.json();
            document.getElementById('schedTable').innerHTML = data.map(s => `
                <tr>
                    <td>${s.employee_id}</td>
                    <td><span class="badge bg-info text-dark">${s.role_name}</span></td>
                    <td>${s.start_date}</td>
                    <td>${s.end_date}</td>
                    <td><button onclick="delSched(${s.id})" class="btn btn-sm btn-light text-danger">x</button></td>
                </tr>`).join('');
        }
        
        async function saveSchedule() {
            const fd = new FormData();
            fd.append('emp_id', document.getElementById('sch_id').value);
            fd.append('role_name', document.getElementById('sch_rule').value);
            fd.append('start_date', document.getElementById('sch_start').value);
            fd.append('end_date', document.getElementById('sch_end').value);
            await fetch('/api/schedule/assign', { method: 'POST', body: fd });
            loadSchedules();
        }
        async function delSched(id) {
            if(confirm('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏ô‡∏µ‡πâ?')) { await fetch(`/api/schedules/delete/${id}`, {method:'DELETE'}); loadSchedules(); }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        loadEmployees();
        loadRules();
        loadSchedules();
    </script>
</body>
</html>