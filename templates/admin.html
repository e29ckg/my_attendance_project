<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (Admin)</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1, h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="number"], input[type="text"], input[type="password"], input[type="time"] { 
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; 
        }
        .section { margin-bottom: 40px; padding: 20px; background: #f9f9f9; border-radius: 8px; }
        .btn { padding: 10px 20px; border: none; cursor: pointer; color: white; border-radius: 5px; }
        .btn-save { background-color: #007bff; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-red { background-color: #dc3545; padding: 5px 10px; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #333; color: white; }
        .back-link { display: inline-block; margin-bottom: 20px; text-decoration: none; font-size: 18px; color: #555; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <h1>‚öôÔ∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h1>

        <div class="section">
            <h2>üóÑÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Database)</h2>
            <div class="form-group"><label>Host</label><input type="text" id="db_host"></div>
            <div class="form-group"><label>User</label><input type="text" id="db_user"></div>
            <div class="form-group"><label>Password</label><input type="password" id="db_password"></div>
            <div class="form-group"><label>Database Name</label><input type="text" id="db_name"></div>
        </div>
        <div class="section">
            <h2>üì∑ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á & ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</h2>
            <div class="form-group">
                <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡πâ‡∏≠‡∏á (Camera Index)</label>
                <input type="number" id="camIndex" placeholder="‡∏õ‡∏Å‡∏ï‡∏¥ 0">
                <small style="color: gray;">0 = ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å, 1 = ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á (USB)</small>
            </div>
            
            <div class="form-group">
                <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á (Width)</label>
                <input type="number" id="camWidth" placeholder="‡∏õ‡∏Å‡∏ï‡∏¥ 640">
            </div>
            
            <div class="form-group">
                <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á (Height)</label>
                <input type="number" id="camHeight" placeholder="‡∏õ‡∏Å‡∏ï‡∏¥ 480">
            </div>

            <div class="form-group">
                <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô (Interval)</label>
                <input type="number" id="procInterval" placeholder="‡∏õ‡∏Å‡∏ï‡∏¥ 5">
                <small style="color: gray;">‡∏™‡πÅ‡∏Å‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ X ‡πÄ‡∏ü‡∏£‡∏° (‡πÄ‡∏•‡∏Ç‡∏ô‡πâ‡∏≠‡∏¢=‡∏™‡πÅ‡∏Å‡∏ô‡∏ñ‡∏µ‡πà, ‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å=‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏∑‡πà‡∏ô)</small>
            </div>
        </div>

        <div class="section">
            <h2>ü§ñ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ AI & ‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <div class="form-group">
                <label>‚è±Ô∏è Cooldown (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</label>
                <input type="number" id="cooldown">
            </div>
            <div class="form-group">
                <label>üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (Threshold 0.1-0.9)</label>
                <input type="number" step="0.01" id="threshold">
            </div>
            <div class="form-group">
                <label>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≤‡∏¢</label>
                <input type="time" id="lateTime">
            </div>
            <div style="margin-top: 15px;">
                <input type="checkbox" id="voice"> ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
                <input type="checkbox" id="smartCool" style="margin-left: 20px;"> ‡∏Å‡∏±‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥
            </div>
            <button class="btn btn-save" onclick="saveSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        

        <div class="section">
            <h2>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
            <button class="btn" style="background:#6c757d; margin-bottom:10px;" onclick="loadEmps()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
            <table>
                <thead><tr><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                <tbody id="empTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ Settings
        async function loadSettings() {
            const res = await fetch('/api/settings');
            const d = await res.json();
            
            // DB Config
            document.getElementById('db_host').value = d.db_host || "localhost";
            document.getElementById('db_user').value = d.db_user || "root";
            document.getElementById('db_password').value = d.db_password || "";
            document.getElementById('db_name').value = d.db_name || "attendance_system";

            // System Config
            document.getElementById('cooldown').value = d.cooldown_seconds;
            document.getElementById('threshold').value = d.threshold;
            document.getElementById('lateTime').value = d.late_time;
            document.getElementById('voice').checked = d.enable_voice;
            document.getElementById('smartCool').checked = d.enable_cooldown;
            // Camera Config
            document.getElementById('camIndex').value = d.camera_index || 0;
            document.getElementById('camWidth').value = d.camera_width || 640;
            document.getElementById('camHeight').value = d.camera_height || 480;
            document.getElementById('procInterval').value = d.process_interval || 5;
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Settings
        async function saveSettings() {
            const config = {
                db_host: document.getElementById('db_host').value,
                db_user: document.getElementById('db_user').value,
                db_password: document.getElementById('db_password').value,
                db_name: document.getElementById('db_name').value,
                cooldown_seconds: parseInt(document.getElementById('cooldown').value),
                threshold: parseFloat(document.getElementById('threshold').value),
                late_time: document.getElementById('lateTime').value,
                enable_voice: document.getElementById('voice').checked,
                enable_cooldown: document.getElementById('smartCool').checked,
                camera_index: parseInt(document.getElementById('camIndex').value),
                camera_width: parseInt(document.getElementById('camWidth').value),
                camera_height: parseInt(document.getElementById('camHeight').value),
                process_interval: parseInt(document.getElementById('procInterval').value)
            };
            await fetch('/api/save_settings', { method:'POST', body: JSON.stringify(config) });
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! (‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ DB ‡∏ï‡πâ‡∏≠‡∏á Restart ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà)");
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        async function loadEmps() {
            const res = await fetch('/api/employees');
            const data = await res.json();
            const tbody = document.getElementById('empTableBody');
            tbody.innerHTML = '';
            data.forEach(emp => {
                const path = emp.image_path.replace(/\\/g, "/");
                tbody.innerHTML += `
                    <tr>
                        <td><img src="/${path}" style="width:50px; height:50px; object-fit:cover; border-radius:50%;"></td>
                        <td>${emp.name}</td>
                        <td><button class="btn btn-red" onclick="delEmp(${emp.id})">‡∏•‡∏ö</button></td>
                    </tr>`;
            });
        }
        async function delEmp(id) {
            if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ?")) {
                await fetch(`/api/delete_employee/${id}`, { method:'DELETE' });
                loadEmps();
            }
        }

        loadSettings();
        loadEmps();
    </script>
</body>
</html>