<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - Time Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        body { background-color: #f4f6f9; font-family: 'Sarabun', sans-serif; }
        .navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .table-img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }
        .search-box input { padding-left: 40px; }
        .list-group-item { display: flex; justify-content: space-between; align-items: center; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Modal ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ */
        .setting-header { background-color: #f8f9fa; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 15px; font-weight: bold; color: #495057; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top mb-4 shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="/"><i class="bi bi-person-bounding-box"></i> HR Face Scan</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (‡∏™‡πÅ‡∏Å‡∏ô)</a></li>
                    <li class="nav-item"><a class="nav-link" href="/admin">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</a></li>
                    <li class="nav-item"><a class="nav-link" href="/report">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</a></li>
                    <li class="nav-item"><a class="nav-link" href="/print">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold text-danger" href="/monitor">üîß Monitor</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="fw-bold text-secondary"><i class="bi bi-people-fill"></i> ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h4>
            <div>
                <button class="btn btn-secondary me-2 shadow-sm" onclick="openSettingModal()">
                    <i class="bi bi-gear-fill"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                </button>
                <button class="btn btn-primary shadow-sm" onclick="openAddModal()">
                    <i class="bi bi-person-plus-fill"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
        </div>

        <div class="card p-3 mb-4">
            <div class="row g-3">
                <div class="col-md-6 position-relative search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" id="searchInput" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô..." onkeyup="filterData()">
                </div>
                <div class="col-md-4">
                    <select id="roleFilter" class="form-select" onchange="filterData()">
                        <option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Role)</option>
                    </select>
                </div>
                <div class="col-md-2 text-end align-self-center">
                    <span class="text-muted small">‡∏û‡∏ö <b id="count">0</b> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                </div>
            </div>
        </div>

        <div class="card p-4">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th width="80">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Role)</th>
                            <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Dep)</th> <th width="150" class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="employeeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="modalTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="empForm">
                        <input type="hidden" id="mode" value="add">
                        
                        <div class="mb-3">
                            <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                            <input type="text" class="form-control" id="empId" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" class="form-control" id="empName" required>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Role)</label>
                                <select class="form-select" id="empRole" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Dep)</label>
                                <select class="form-select" id="empDep" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                                </select>
                            </div>
                            <div class="col-12 text-end mt-1">
                                <a href="#" onclick="myModal.hide(); openSettingModal();" class="text-decoration-none small text-muted">
                                    <i class="bi bi-gear"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                                </a>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</label>
                            <input type="file" class="form-control" id="empPhoto" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" class="btn btn-primary" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="settingModal" tabindex="-1">
        <div class="modal-dialog modal-lg"> <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title fw-bold"><i class="bi bi-gear-fill"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 border-end">
                            <div class="setting-header">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (Role)</div>
                            <div class="input-group mb-3">
                                <input type="text" id="newRoleInput" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞, ‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô">
                                <button class="btn btn-success" type="button" onclick="addNewRole()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            </div>
                            <ul class="list-group" id="roleList" style="max-height: 300px; overflow-y: auto;"></ul>
                        </div>

                        <div class="col-md-6">
                            <div class="setting-header">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡πÅ‡∏ú‡∏ô‡∏Å (Department)</div>
                            <div class="input-group mb-3">
                                <input type="text" id="newDepInput" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏∞, ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏ü‡πâ‡∏≤">
                                <button class="btn btn-success" type="button" onclick="addNewDep()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                            </div>
                            <ul class="list-group" id="depList" style="max-height: 300px; overflow-y: auto;"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = ""; 
        let allEmployees = [];
        let allRoles = [];
        let allDeps = [];

        // --- ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        async function loadEmployees() {
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
                await loadOptions();
                
                const res = await axios.get(`${API_BASE}/api/employees`);
                allEmployees = res.data;
                renderTable(allEmployees);
            } catch (error) { console.error(error); }
        }

        async function loadOptions() {
            try {
                // 1. Load Roles
                const resRole = await axios.get(`${API_BASE}/api/roles`);
                allRoles = resRole.data;
                
                // 2. Load Departments
                const resDep = await axios.get(`${API_BASE}/api/departments`);
                allDeps = resDep.data;

                // Update Dropdowns
                updateDropdowns();
            } catch (error) { console.error(error); }
        }

        function updateDropdowns() {
            // Role Filter
            const filterSel = document.getElementById('roleFilter');
            const currentFilter = filterSel.value;
            filterSel.innerHTML = '<option value="all">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Role)</option>';
            allRoles.forEach(r => filterSel.innerHTML += `<option value="${r}">${r}</option>`);
            filterSel.value = currentFilter;

            // Modal: Role Select
            const modalRole = document.getElementById('empRole');
            modalRole.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            allRoles.forEach(r => modalRole.innerHTML += `<option value="${r}">${r}</option>`);

            // Modal: Dep Select
            const modalDep = document.getElementById('empDep');
            modalDep.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            allDeps.forEach(d => modalDep.innerHTML += `<option value="${d}">${d}</option>`);
        }

        // --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ---
        function renderTable(data) {
            const tbody = document.getElementById('employeeTable');
            document.getElementById('count').innerText = data.length;
            tbody.innerHTML = "";
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`; return;
            }
            data.forEach(emp => {
                const imgUrl = emp.image_path ? `${API_BASE}/${emp.image_path}?t=${Date.now()}` : "https://via.placeholder.com/50";
                const safeName = emp.name.replace(/'/g, "\\'").replace(/"/g, "&quot;");
                
                // ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const role = emp.role || '-';
                const dep = emp.department || '-';

                tbody.innerHTML += `
                <tr>
                    <td><img src="${imgUrl}" class="table-img"></td>
                    <td class="fw-bold text-secondary">${emp.employee_id}</td>
                    <td>${emp.name}</td>
                    <td><span class="badge bg-light text-dark border">${role}</span></td>
                    <td><span class="badge bg-info text-dark bg-opacity-25 border border-info">${dep}</span></td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-warning me-1" onclick="openEditModal('${emp.employee_id}', '${safeName}', '${role}', '${dep}')"><i class="bi bi-pencil-fill"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteEmp('${emp.employee_id}')"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>`;
            });
        }

        function filterData() {
            const txt = document.getElementById('searchInput').value.toLowerCase();
            const role = document.getElementById('roleFilter').value;
            renderTable(allEmployees.filter(e => 
                (e.name.toLowerCase().includes(txt) || e.employee_id.toLowerCase().includes(txt)) &&
                (role === "all" || e.role === role)
            ));
        }

        // --- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (Add/Edit) ---
        const myModal = new bootstrap.Modal(document.getElementById('employeeModal'));
        
        function openAddModal() {
            document.getElementById('modalTitle').innerText = "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà";
            document.getElementById('mode').value = "add";
            document.getElementById('empForm').reset();
            document.getElementById('empId').disabled = false;
            // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î options ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô setting modal
            loadOptions(); 
            myModal.show();
        }

        function openEditModal(id, name, role, dep) {
            document.getElementById('modalTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            document.getElementById('mode').value = "edit";
            document.getElementById('empId').value = id;
            document.getElementById('empName').value = name;
            document.getElementById('empId').disabled = true;
            document.getElementById('empPhoto').value = "";
            
            // ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î options ‡∏Å‡πà‡∏≠‡∏ô set ‡∏Ñ‡πà‡∏≤
            loadOptions().then(() => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                addTempOption('empRole', role);
                addTempOption('empDep', dep);
                
                document.getElementById('empRole').value = role;
                document.getElementById('empDep').value = dep;
            });

            myModal.show();
        }

        function addTempOption(selectId, value) {
            if (!value || value === '-') return;
            const sel = document.getElementById(selectId);
            if (![...sel.options].some(o => o.value === value)) {
                const opt = document.createElement('option');
                opt.value = value;
                opt.innerText = value + " (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°)";
                sel.add(opt);
            }
        }

        async function saveData() {
            const mode = document.getElementById('mode').value;
            const id = document.getElementById('empId').value;
            const name = document.getElementById('empName').value;
            const role = document.getElementById('empRole').value;
            const dep = document.getElementById('empDep').value;
            const file = document.getElementById('empPhoto').files[0];
            
            if (!id || !name || !role) { Swal.fire('‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning'); return; }
            
            const formData = new FormData();
            formData.append('emp_id', id);
            formData.append('name', name);
            formData.append('role', role);
            formData.append('department', dep); // ‡∏™‡πà‡∏á department ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
            if (file) formData.append('file', file);
            
            const url = mode === "add" ? "/api/register" : "/api/employees/update";
            try {
                Swal.fire({title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading()});
                await axios.post(`${API_BASE}${url}`, formData);
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                myModal.hide(); loadEmployees();
            } catch (e) { Swal.fire('Error', e.message, 'error'); }
        }

        async function deleteEmp(id) {
            if((await Swal.fire({title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?', showCancelButton:true})).isConfirmed){
                await axios.delete(`${API_BASE}/api/employees/delete/${id}`);
                loadEmployees();
            }
        }

        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Role & Department) ---
        const settingModal = new bootstrap.Modal(document.getElementById('settingModal'));
        
        function openSettingModal() {
            renderRoleList();
            renderDepList();
            settingModal.show();
        }

        // 1. Role Logic
        function renderRoleList() {
            const list = document.getElementById('roleList');
            list.innerHTML = "";
            allRoles.forEach(r => {
                list.innerHTML += `
                <li class="list-group-item">
                    ${r} <button class="btn btn-sm btn-outline-danger" onclick="deleteRole('${r}')"><i class="bi bi-trash"></i></button>
                </li>`;
            });
        }
        async function addNewRole() {
            const val = document.getElementById('newRoleInput').value.trim();
            if(!val) return;
            await axios.post(`${API_BASE}/api/roles`, {role_name: val}, {headers: {'Content-Type': 'multipart/form-data'}}); // ‡πÉ‡∏ä‡πâ Form Data ‡∏ï‡∏≤‡∏° Backend
            const fd = new FormData(); fd.append('role_name', val);
            await axios.post(`${API_BASE}/api/roles`, fd);

            document.getElementById('newRoleInput').value = "";
            await loadOptions(); renderRoleList();
        }
        async function deleteRole(val) {
            if(!confirm(`‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "${val}" ?`)) return;
            await axios.delete(`${API_BASE}/api/roles/${val}`);
            await loadOptions(); renderRoleList();
        }

        // 2. Department Logic
        function renderDepList() {
            const list = document.getElementById('depList');
            list.innerHTML = "";
            allDeps.forEach(d => {
                list.innerHTML += `
                <li class="list-group-item">
                    ${d} <button class="btn btn-sm btn-outline-danger" onclick="deleteDep('${d}')"><i class="bi bi-trash"></i></button>
                </li>`;
            });
        }
        async function addNewDep() {
            const val = document.getElementById('newDepInput').value.trim();
            if(!val) return;
            const fd = new FormData(); fd.append('dep_name', val);
            await axios.post(`${API_BASE}/api/departments`, fd);
            
            document.getElementById('newDepInput').value = "";
            await loadOptions(); renderDepList();
        }
        async function deleteDep(val) {
            if(!confirm(`‡∏•‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡πÅ‡∏ú‡∏ô‡∏Å "${val}" ?`)) return;
            await axios.delete(`${API_BASE}/api/departments/${val}`);
            await loadOptions(); renderDepList();
        }

        // Start
        loadEmployees();
    </script>
</body>
</html>