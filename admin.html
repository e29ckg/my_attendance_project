<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô - Face Recognition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; }
        .card-img-top { height: 200px; object-fit: cover; }
    </style>
</head>
<body class="p-4">
    <div class="container">
        <h2 class="mb-4">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
        
        <div class="card p-4 mb-4 shadow-sm">
            <h5>‚ûï ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h5>
            <form id="addForm" class="row g-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="empId" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" required>
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="empName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="empRole" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" required>
                </div>
                <div class="col-md-3">
                    <input type="file" class="form-control" id="empPhoto" accept="image/*" required>
                </div>
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </form>
        </div>

        <div class="card p-4 shadow-sm">
            <h5>üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
            <div id="employeeList" class="row g-4 mt-2">
                </div>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:9876"; // ‚ö†Ô∏è ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏ô‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô IP Server

        // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
        async function loadEmployees() {
            try {
                const res = await axios.get(`${API_URL}/api/employees`);
                const list = document.getElementById('employeeList');
                list.innerHTML = "";
                
                res.data.forEach(emp => {
                    // ‡πÉ‡∏ä‡πâ Timestamp ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Browser ‡∏à‡πç‡∏≤‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤ (Cache)
                    const imgUrl = `${API_URL}/${emp.image_path}?t=${new Date().getTime()}`;
                    
                    const html = `
                    <div class="col-md-3 col-6">
                        <div class="card h-100">
                            <img src="${imgUrl}" class="card-img-top" onerror="this.src='https://via.placeholder.com/200'">
                            <div class="card-body text-center">
                                <h5 class="card-title">${emp.name}</h5>
                                <p class="card-text text-muted">${emp.role} (${emp.employee_id})</p>
                                <button onclick="deleteEmp('${emp.employee_id}')" class="btn btn-danger btn-sm">‡∏•‡∏ö</button>
                            </div>
                        </div>
                    </div>`;
                    list.innerHTML += html;
                });
            } catch (e) { console.error(e); }
        }

        // 2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        document.getElementById('addForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('emp_id', document.getElementById('empId').value);
            formData.append('name', document.getElementById('empName').value);
            formData.append('role', document.getElementById('empRole').value);
            formData.append('file', document.getElementById('empPhoto').files[0]);

            try {
                alert("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• AI ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...");
                await axios.post(`${API_URL}/api/register`, formData);
                alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                document.getElementById('addForm').reset();
                loadEmployees();
            } catch (e) { 
                alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message); 
            }
        });

        // 3. ‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        async function deleteEmp(id) {
            if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™ ${id} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
            try {
                await axios.delete(`${API_URL}/api/employees/delete/${id}`);
                loadEmployees();
            } catch (e) { alert("‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        loadEmployees();
    </script>
</body>
</html>